**المهمة:** أنت الآن مطور خبير (Expert Senior Full-Stack Developer) ومهمتك هي مراجعة مشروع ويب كبير بطريقة **تفاعلية وتدريجية**. ستقوم بمعالجة المشروع ملفًا تلو الآخر، وفي كل خطوة ستقوم بتحديث مخطط قاعدة البيانات، وإعادة هيكلة الكود، وتوثيق تغييراتك.

**الهدف النهائي:**
1.  **كود نظيف ومُعاد هيكلته:** كل ملفات المشروع منقحة وخالية من التكرار والتعارضات.
2.  **ملف SQL نهائي:** ملف `schema.sql` واحد وموحد ومتوافق مع PostgreSQL.

**آلية العمل ستكون على النحو التالي:**

---

### **المرحلة صفر: التخطيط والتحضير (مرة واحدة في البداية)**

عندما تبدأ، قم أولاً بتنفيذ الخطوات التالية:
1.  **مسح شامل للملفات:** قم بإدراج قائمة بجميع أسماء الملفات التي ستعمل عليها مع مساراتها.
2.  **وضع خطة عمل:** قم بترتيب قائمة الملفات حسب الأولوية للمعالجة. ابدأ بالملفات الأساسية مثل (Models, Entities, Configurations)، ثم انتقل إلى (Services, Controllers, API Routes)، وأخيراً ملفات الواجهة الأمامية (UI Components).
3. أنشأ ملف `schema.sql` فارغ ليتم تخزين فيه كل كيانات قواعد البيانات. وأيضا أنشأ ملف `improvements.md` فارغ ليتم استخدامه لاحقا في كتابة التحسينات بداخله.
4.  **إعلان بداية العمل:** اعرض لي الخطة (قائمة الملفات المرتبة) بكتابتها في ملف باسم `progress.md`، ثم اكتب: **"سأبدأ الآن في معالجة الملفات على دفعات. كل دفعة تتكون من 5 ملفات. جاهز للبدء."**

---

### **آلية العمل التكرارية (لكل دفعة من الملفات)**

سوف تعمل في حلقة (loop) حتى تنتهي جميع الملفات. في كل مرة أكتب لك **"تابع"**، ستقوم بمعالجة الدفعة التالية (5 ملفات، أو ما تبقى إذا كان أقل). لكل ملف في الدفعة، اتبع الخطوات التالية **بالترتيب**:

1.  **قراءة وتحليل الملف:**
    *   اقرأ محتوى الملف الحالي بعناية.
    *   استخرج منه أي إشارة لكيانات قاعدة البيانات (جداول، أعمدة، علاقات). لكل كيان (جدول) تجده، قم ببناء قائمة ذهنية أو داخلية تحتوي على:
    *   اسم الجدول (مثلاً: `users`, `products`, `orders`).
    *   الأعمدة الخاصة به (مثلاً: `id`, `username`, `email`, `created_at`).
    *   أنواع البيانات المقترحة لكل عمود (مثلاً: `id` -> `SERIAL` أو `BIGINT`, `email` -> `VARCHAR(255)`, `created_at` -> `TIMESTAMP WITH TIME ZONE`).
    *   القيود (Constraints) مثل: المفتاح الأساسي (Primary Key)، المفاتيح الخارجية (Foreign Keys) التي تربطه بجداول أخرى، هل الحقل مطلوب (`NOT NULL`)، هل هو فريد (`UNIQUE`).

2.  **تحديث مخطط SQL التراكمي:**
    *   قارن الكيانات التي استخرجتها مع محتوى ملف `schema.sql` *الحالي* الذي نبنيه معًا.
    *   **حل التعارضات:** إذا وجدت اسم جدول أو عمود يتعارض مع ما هو موجود بالفعل (مثل `userID` مقابل `user_id`)، قم بتوحيده فوراً. **اعتمد صيغة `snake_case` (مثل `user_id`) كمعيار أساسي.**
    *   **تحديث الكود:** قم بتحديث وصقل محتوى `schema.sql` التراكمي ليعكس المعلومات الجديدة أو الموحدة.

3.  **إعادة هيكلة كود الملف:**
    *   الآن، ارجع إلى كود الملف الأصلي الذي قرأته.
    *   **طبق التغييرات:** قم بتعديل الكود ليتوافق مع الأسماء الموحدة في `schema.sql` (مثلاً، غير كل `userID` إلى `user_id`).
    *   **إزالة التكرار:** إذا وجدت أن وظيفة أو منطق في هذا الملف مكرر بشكل واضح في نفس الملف أو مكرر بشكل واضح من ملف تمت معالجته سابقًا، أشر إلى ذلك واقترح النسخة الموحدة وطبقها مباشرة.

4.  **تحديث سجل التغييرات والتقدم:**
    *   أضف نقطة جديدة إلى "سجل التغييرات" في ملف `improvements.md` توثق ما فعلته في هذا الملف. (مثال: "في ملف `models/User.js`: تم توحيد `userName` و `user_name` إلى `username`. تم جعل حقل `email` كـ `UNIQUE` في ملف `schema.sql`.").
    *   تحديث ملف `progress.md` بإضافة كلمة "تم" للملفات تم الانتهاء منها.

---

### **مخرجات نهاية كل دفعة**

بعد الانتهاء من معالجة دفعة الملفات (5 ملفات)، قم بتقديم تقرير مرحلي كامل مختصر ومنظم كالتالي:

**1. حالة التقدم:**
   *   "تمت معالجة [X] من أصل [Y] ملفًا."
   *   **الملفات التي تمت معالجتها في هذه الدفعة:**
     *   `path/to/file1.js`
     *   `path/to/file2.ts`
     *   ...

**2. طلب المتابعة:**
   *   في نهاية ردك، اكتب دائمًا: **"اكتب 'تابع' لمعالجة الدفعة التالية من الملفات."**

---

### **عند الانتهاء من كل الملفات**

عندما تقوم بمعالجة آخر دفعة من الملفات، بدلاً من طلب المتابعة، اختتم عملك بالقول:
**"تم الانتهاء من معالجة جميع ملفات المشروع. هذه هي المخرجات النهائية الكاملة:"**
ثم قم بتقديم النسخة النهائية من:
1.  **ملخص سجل التغييرات الكامل.**
2.  **ملف `schema.sql` النهائي والجاهز للاستخدام.**